<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="/css/styles.css">
        <title>Watchlist</title>
    </head>
    <body>
        <header>
            <%- include('partials/header') %>
        </header>

        <style>
            body {
                font-family: Arial, sans-serif;
            }
            #movie-form {
                display: none; /* Hidden by default */
                margin-top: 20px;
                padding: 10px;
                border: 1px solid #ccc;
                width: 300px;
                background: #f9f9f9;
            }
            .form-group {
                margin-bottom: 10px;
            }
        </style>

        <button class="add-movie-button">Add Movie</button>

        <form id="movie-form" action="/watchlist/add/<%=username%>" method="post">
            <h3>Add Movie / Show</h3>
            <div class="form-group">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" placeholder="Enter title">
            </div>
            <div class="form-group">
                <label for="genre">Genre:</label>
                <input type="text" id="genre" name="genre" placeholder="Enter genre">
            </div>
            <div class="form-group">
                <label for="imageUrl">Image Url:</label>
                <input type="text" id="imageURL" name="imageURL" placeholder="Enter an Image URL">
            </div>
            <div class="form-group">
                <label for="is-show">Is this a TV Show?</label>
                <input type="checkbox" id="is-show" name="isShow" value="true">
            </div>
            <div id="show-details" style="display: none;">
                <div class="form-group">
                    <label for="season">Season:</label>
                    <input type="number" id="season" name="season" placeholder="Enter season">
                </div>
                <div class="form-group">
                    <label for="episode">Episode:</label>
                    <input type="number" id="episode" name="episode" placeholder="Enter episode">
                </div>
            </div>
            <button type="submit" id="submit-movie">Submit</button>
            <button id="cancel-movie">Cancel</button>
        </form>

        <input type="text" class="search-bar" placeholder="Search">
        <button class="search-button">Search</button>

        <select class="sort-dropdown">
            <option value="" disabled selected>Sort by...</option>
            <option class="sort-option">Genre</option>
            <option class="sort-option">Alphabetically</option>
        </select>

        <ul id="movie-list"></ul> <!-- The ul to display movies/shows -->

        <script>
            // Ensure the DOM is loaded before accessing elements
            document.addEventListener('DOMContentLoaded', () => {
                const addButton = document.querySelector('.add-movie-button');
                const movieForm = document.getElementById('movie-form');
                const submitButton = document.getElementById('submit-movie');
                const cancelButton = document.getElementById('cancel-movie');
                const isShowCheckbox = document.getElementById('is-show');
                const showDetails = document.getElementById('show-details');
                const movieList = document.getElementById('movie-list');

                // Show the form when "Add Movie" is clicked
                addButton.addEventListener('click', () => {
                    movieForm.style.display = 'block';
                });

                // Hide the form when "Cancel" is clicked
                cancelButton.addEventListener('click', () => {
                    movieForm.style.display = 'none';
                });

                // Show or hide the Season/Episode fields based on checkbox
                isShowCheckbox.addEventListener('change', () => {
                    showDetails.style.display = isShowCheckbox.checked ? 'block' : 'none';
                });

                // Search functionality
                const searchButton = document.querySelector('.search-button');
                const searchInput = document.querySelector('.search-bar');
                
                searchButton.addEventListener('click', () => {
                    const searchTerm = searchInput.value.trim().toLowerCase();
                    const movieListItems = document.querySelectorAll('#movie-list li');

                    movieListItems.forEach(item => {
                        if (item.textContent.toLowerCase().includes(searchTerm)) {
                            item.style.display = 'list-item'; // Show matching item
                        } else {
                            item.style.display = 'none'; // Hide non-matching item
                        }
                    });
                });
            });
        </script>
        <ul>
            <% if(moviesAndShows != undefined) {%>
                <% moviesAndShows.forEach(movie => { %>
                    <li>
                        <img class="cover-image" src="<%= movie.imageURL %>" alt="<%= movie.title%>"/>
                        <%= movie.title %> - <%= movie.genre %>
                    <% if (movie.season && movie.episode) { %>
                        (Season <%= movie.season %>, Episode <%= movie.episode %>)
                    <% } %>
                    </li>
                <% }); %>
            <% } else { %>
                <li>Your watchlist is empty.</li>
            <% } %>
        </ul>
    </body>
</html>